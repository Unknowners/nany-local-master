# üöÄ –ü–ª–∞–Ω –º—ñ–≥—Ä–∞—Ü—ñ—ó –∑ SQLAlchemy ORM –Ω–∞ —á–∏—Å—Ç—ñ SQL + Alembic

## üéØ –ú–µ—Ç–∞
–ü–æ–≤–Ω—ñ—Å—Ç—é –≤—ñ–¥–º–æ–≤–∏—Ç–∏—Å—è –≤—ñ–¥ SQLAlchemy ORM —Ç–∞ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞:
- –ß–∏—Å—Ç—ñ SQL –∑–∞–ø–∏—Ç–∏ —á–µ—Ä–µ–∑ `sqlalchemy.text()`
- Alembic –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ–π –∑–∞–º—ñ—Å—Ç—å —Ä—É—á–Ω–∏—Ö SQL —Ñ–∞–π–ª—ñ–≤
- –ü—Ä–æ—Å—Ç—ñ—à—ñ —Ç–∞ —à–≤–∏–¥—à—ñ –∑–∞–ø–∏—Ç–∏
- –õ–µ–≥—à–µ –¥–µ–±–∞–≥–∏—Ç–∏ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏

## üìã –ü–ª–∞–Ω –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

### –§–ê–ó–ê 1: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ ‚úÖ
- [x] –°—Ç–≤–æ—Ä–∏—Ç–∏ `SimpleSQLService` –∑ –±–∞–∑–æ–≤–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏
- [x] –°—Ç–≤–æ—Ä–∏—Ç–∏ `simple_api` —Ä–æ—É—Ç–µ—Ä –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- [x] –î–æ–¥–∞—Ç–∏ debug –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∞–±–ª–∏—Ü—å

### –§–ê–ó–ê 2: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Alembic
- [ ] –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ Alembic –≤ –ø—Ä–æ–µ–∫—Ç—ñ
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ –±–∞–∑–æ–≤—É –º—ñ–≥—Ä–∞—Ü—ñ—é –∑ –ø–æ—Ç–æ—á–Ω–æ—ó —Å—Ö–µ–º–∏ –ë–î
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —ñ—Å–Ω—É—é—á—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó –≤ Alembic —Ñ–æ—Ä–º–∞—Ç
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—é –º—ñ–≥—Ä–∞—Ü—ñ–π

### –§–ê–ó–ê 3: –ü–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –µ–Ω–¥–ø–æ—ñ–Ω—Ç—ñ–≤
#### 3.1 –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ
- [ ] `/api/v1/auth/*` - –ª–æ–≥—ñ–Ω, —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è, OTP
- [ ] `/api/v1/profiles` - CRUD –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ –ø—Ä–æ—Ñ—ñ–ª—è–º–∏
- [ ] `/api/v1/auth/me` - –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

#### 3.2 –û–Ω–±–æ—Ä–¥–∏–Ω–≥
- [ ] `/api/v1/onboarding/save-simple`
- [ ] `/api/v1/onboarding/complete`
- [ ] `/api/v1/user_onboarding_data`

#### 3.3 –°–≤–∞–π–ø–∏ —Ç–∞ –º–∞—Ç—á—ñ
- [ ] `/api/v1/swipes` - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–≤–∞–π–ø—ñ–≤
- [ ] `/api/v1/swipes/my-likes` - –º–æ—ó –ª–∞–π–∫–∏
- [ ] `/api/v1/swipes/received-likes` - –æ—Ç—Ä–∏–º–∞–Ω—ñ –ª–∞–π–∫–∏
- [ ] `/api/v1/matches` - –º–∞—Ç—á—ñ

#### 3.4 –ü–æ—à—É–∫
- [ ] `/api/v1/search/nannies/complete` - –ø–æ—à—É–∫ –Ω—è–Ω—å
- [ ] `/api/v1/search/parents/complete` - –ø–æ—à—É–∫ –±–∞—Ç—å–∫—ñ–≤
- [ ] `/api/v1/nannies` - —Å–ø–∏—Å–æ–∫ –Ω—è–Ω—å
- [ ] `/api/v1/parents` - —Å–ø–∏—Å–æ–∫ –±–∞—Ç—å–∫—ñ–≤

#### 3.5 –ß–∞—Ç–∏ —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- [ ] `/api/v1/chats` - —Å–ø–∏—Å–æ–∫ —á–∞—Ç—ñ–≤
- [ ] `/api/v1/chats/{chat_id}/messages` - –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- [ ] –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —á–∞—Ç—ñ–≤ –ø—Ä–∏ –º–∞—Ç—á–∞—Ö

#### 3.6 –î–æ–≤—ñ–¥–Ω–∏–∫–∏
- [ ] `/api/v1/reference/categories`
- [ ] `/api/v1/reference/values/{category}`

### –§–ê–ó–ê 4: –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏
- [ ] –í—Å—ñ `/api/v1/admin/*` –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏
- [ ] –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏

### –§–ê–ó–ê 5: –û—á–∏—â–µ–Ω–Ω—è –∫–æ–¥—É
- [ ] –í–∏–¥–∞–ª–∏—Ç–∏ SQLAlchemy –º–æ–¥–µ–ª—ñ –∑ `models.py`
- [ ] –í–∏–¥–∞–ª–∏—Ç–∏ ORM —Å–µ—Ä–≤—ñ—Å–∏
- [ ] –í–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç–∞—Ä—ñ —Ä–æ—É—Ç–µ—Ä–∏
- [ ] –û–Ω–æ–≤–∏—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é

## üõ† –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–æ–≤–æ–≥–æ –∫–æ–¥—É:
```
app/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ sql_service.py          # –ë–∞–∑–æ–≤–∏–π SQL —Å–µ—Ä–≤—ñ—Å
‚îÇ   ‚îú‚îÄ‚îÄ auth_sql_service.py     # –ê—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è
‚îÇ   ‚îú‚îÄ‚îÄ swipes_sql_service.py   # –°–≤–∞–π–ø–∏ —Ç–∞ –º–∞—Ç—á—ñ
‚îÇ   ‚îú‚îÄ‚îÄ search_sql_service.py   # –ü–æ—à—É–∫
‚îÇ   ‚îî‚îÄ‚îÄ chat_sql_service.py     # –ß–∞—Ç–∏
‚îú‚îÄ‚îÄ routers/
‚îÇ   ‚îú‚îÄ‚îÄ auth_sql.py            # –ù–æ–≤—ñ —Ä–æ—É—Ç–µ—Ä–∏ –∑ SQL
‚îÇ   ‚îú‚îÄ‚îÄ swipes_sql.py
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ alembic/                   # Alembic –º—ñ–≥—Ä–∞—Ü—ñ—ó
‚îÇ   ‚îú‚îÄ‚îÄ versions/
‚îÇ   ‚îî‚îÄ‚îÄ env.py
‚îî‚îÄ‚îÄ schemas/                   # Pydantic —Å—Ö–µ–º–∏ (–∑–∞–ª–∏—à–∞—é—Ç—å—Å—è)
```

### –ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–æ–≤–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É:
1. **–ü—Ä–æ–∑–æ—Ä—ñ—Å—Ç—å**: –í–∏–¥–Ω–æ —Ç–æ—á–Ω–æ —è–∫–∏–π SQL –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è
2. **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: –ù–µ–º–∞—î ORM overhead
3. **–ö–æ–Ω—Ç—Ä–æ–ª—å**: –ü–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∑–∞–ø–∏—Ç–∞–º–∏
4. **–î–µ–±–∞–≥**: –õ–µ–≥–∫–æ –ª–æ–≥—É–≤–∞—Ç–∏ —Ç–∞ –¥–µ–±–∞–≥–∏—Ç–∏ SQL
5. **–ú—ñ–≥—Ä–∞—Ü—ñ—ó**: Alembic –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä—É—î –º—ñ–≥—Ä–∞—Ü—ñ—ó
6. **–¢–∏–ø–∏**: –ù–µ–º–∞—î –ø—Ä–æ–±–ª–µ–º –∑ UUID vs VARCHAR

### –ü—Ä–∏–∫–ª–∞–¥ –Ω–æ–≤–æ–≥–æ –∫–æ–¥—É:
```python
class AuthSQLService:
    def __init__(self, db: Session):
        self.db = db
    
    def get_user_by_phone(self, phone: str) -> Optional[Dict]:
        query = """
            SELECT user_id, phone, first_name, last_name, 
                   role, onboarding_completed, created_at
            FROM profiles 
            WHERE phone = :phone
        """
        return self.execute_single(query, {"phone": phone})
    
    def create_user(self, user_data: Dict) -> Dict:
        query = """
            INSERT INTO profiles (user_id, phone, first_name, last_name, 
                                role, password_hash, created_at)
            VALUES (:user_id, :phone, :first_name, :last_name, 
                    :role, :password_hash, NOW())
            RETURNING user_id, phone, first_name, last_name, role
        """
        return self.execute_single(query, user_data)
```

## üìä –ü—Ä–æ–≥—Ä–µ—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è

### –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å:
- ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –±–∞–∑–æ–≤—É —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
- ‚úÖ –ü—Ä–æ—Å—Ç–∏–π API –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
- üîÑ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Å—Ç–∏—Ö –µ–Ω–¥–ø–æ—ñ–Ω—Ç—ñ–≤
- ‚è≥ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Alembic

### –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:
1. –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ—Å—Ç–∏–π API
2. –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Alembic
3. –ü–æ—á–∞—Ç–∏ –ø–µ—Ä–µ–ø–∏—Å—É–≤–∞–Ω–Ω—è –ø–æ –æ–¥–Ω–æ–º—É –µ–Ω–¥–ø–æ—ñ–Ω—Ç—É
4. –ü–æ—Å—Ç—É–ø–æ–≤–æ –∑–∞–º—ñ–Ω—é–≤–∞—Ç–∏ —Å—Ç–∞—Ä—ñ —Ä–æ—É—Ç–µ—Ä–∏

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç
- –ü—Ä–æ—Å—Ç—ñ—à–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
- –®–≤–∏–¥—à—ñ –∑–∞–ø–∏—Ç–∏
- –õ–µ–≥—à–µ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏
- –ú–µ–Ω—à–µ –±–∞–≥—ñ–≤ –∑ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–∏—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó —á–µ—Ä–µ–∑ Alembic
