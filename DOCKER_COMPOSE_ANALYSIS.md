# üîç –ê–Ω–∞–ª—ñ–∑ Docker Compose —Ç–∞ –ø—Ä–∏—á–∏–Ω —Å–∫–∏–¥–∞–Ω–Ω—è –±–∞–∑–∏

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω—ñ —Å–∫–∏–¥–∞–ª–∞—Å—è –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –±—ñ–ª–¥—ñ —á–µ—Ä–µ–∑ Docker Compose –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é.

## üìä –ê–Ω–∞–ª—ñ–∑ Docker Compose

### PostgreSQL –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è (docker-compose.prod.yml):
```yaml
postgres:
  image: postgres:15-alpine
  container_name: nanny-match-postgres
  environment:
    POSTGRES_DB: nanny_match_prod
    POSTGRES_USER: app
    POSTGRES_PASSWORD: ${DB_PASSWORD}
  volumes:
    - postgres_data:/var/lib/postgresql/data  # ‚úÖ Persistent volume
    - ./scripts/init-db.sql:/docker-entrypoint-initdb.d/init-db.sql  # ‚ö†Ô∏è Init script
```

### Backend –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è:
```yaml
backend:
  build:
    context: .
    dockerfile: Dockerfile  # –ü—Ä–æ–¥–∞–∫—à–Ω Dockerfile
  environment:
    - ENVIRONMENT=production  # ‚ùå –ë–ª–æ–∫—É—î dev-admin endpoints!
```

## üö® –ü–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –ø—Ä–∏—á–∏–Ω–∏ —Å–∫–∏–¥–∞–Ω–Ω—è

### 1. **Docker build –ø—Ä–æ—Ü–µ—Å**
```bash
# –í Makefile:
prod-build: docker-compose build --no-cache  # ‚ö†Ô∏è –ü–æ–≤–Ω–∞ –ø–µ—Ä–µ–±—É–¥–æ–≤–∞
```

**–ü—Ä–æ–±–ª–µ–º–∞**: `--no-cache` –º–æ–∂–µ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç–∏ –¥–æ –ø–µ—Ä–µ—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–≤

### 2. **Init script –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**
```sql
-- scripts/init-db.sql –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ø—Ä–∏ –ü–ï–†–®–û–ú–£ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ PostgreSQL
-- –Ø–∫—â–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ—Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è, —Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∑–Ω–æ–≤—É
```

### 3. **Alembic –º—ñ–≥—Ä–∞—Ü—ñ—ó –∑ DELETE –∫–æ–º–∞–Ω–¥–∞–º–∏**
```python
# alembic/versions/345c144ad17e_*.py –≤–∏–∫–æ–Ω—É—î:
# seed-data/03_onboarding_data.sql
# –Ø–∫–∏–π –º—ñ—Å—Ç–∏—Ç—å:
DELETE FROM onboarding_configs;  # ‚ùå –í–∏–¥–∞–ª—è—î –≤—Å—ñ –¥–∞–Ω—ñ!
```

### 4. **–ö–æ–º–∞–Ω–¥–∏ –¥–µ–ø–ª–æ—é**
```bash
# –ù–µ–±–µ–∑–ø–µ—á–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:
docker-compose down -v          # ‚ùå –í–∏–¥–∞–ª—è—î volumes
docker-compose up --force-recreate  # ‚ùå –ü–µ—Ä–µ—Å—Ç–≤–æ—Ä—é—î –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
docker volume prune             # ‚ùå –í–∏–¥–∞–ª—è—î –Ω–µ—ñ—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ volumes
```

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ

### 1. **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ Alembic –º—ñ–≥—Ä–∞—Ü—ñ—ó**
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –±–µ–∑–ø–µ—á–Ω—ñ seed —Ñ–∞–π–ª–∏ –±–µ–∑ DELETE
- –î–æ–¥–∞–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è
- –°—Ç—Ä–æ–≥–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–æ—Ç–∏ DELETE –∫–æ–º–∞–Ω–¥

### 2. **–°—Ç–≤–æ—Ä–µ–Ω–æ –±–µ–∑–ø–µ—á–Ω—ñ seed —Ñ–∞–π–ª–∏**
- `03_onboarding_data_safe.sql` - –±–µ–∑ DELETE –∫–æ–º–∞–Ω–¥
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å `INSERT ... ON CONFLICT`
- –ó–±–µ—Ä—ñ–≥–∞—é—Ç—å —ñ—Å–Ω—É—é—á—ñ –¥–∞–Ω—ñ

### 3. **–î–æ–¥–∞–Ω–æ API –¥–ª—è –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**
- –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–Ω—É –ø—Ä–æ–¥–∞–∫—à–Ω –±–∞–∑–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ endpoints
- –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ vs –ø—Ä–æ–¥–∞–∫—à–Ω

## üõ°Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ

### 1. **–ë–µ–∑–ø–µ—á–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–µ–ø–ª–æ—é**
```bash
# ‚úÖ –ë–ï–ó–ü–ï–ß–ù–û:
docker-compose pull                    # –û–Ω–æ–≤–∏—Ç–∏ –æ–±—Ä–∞–∑–∏
docker-compose up -d --no-deps backend  # –¢—ñ–ª—å–∫–∏ backend
docker-compose restart backend        # –†–µ—Å—Ç–∞—Ä—Ç –±–µ–∑ –ø–µ—Ä–µ—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è

# ‚ùå –ù–ï–ë–ï–ó–ü–ï–ß–ù–û:
docker-compose down -v               # –í–∏–¥–∞–ª—è—î volumes!
docker-compose build --no-cache      # –ú–æ–∂–µ –ø–µ—Ä–µ—Å—Ç–≤–æ—Ä–∏—Ç–∏ –≤—Å–µ
```

### 2. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ volumes**
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ volumes –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ—î–º:
docker volume ls | grep postgres_data

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä –¥–∞–Ω–∏—Ö:
docker volume inspect postgres_data
```

### 3. **Backup —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è**
```bash
# Backup –ø–µ—Ä–µ–¥ –∫–æ–∂–Ω–∏–º –¥–µ–ø–ª–æ—î–º:
docker-compose exec postgres pg_dump -U app nanny_match_prod > backup_$(date +%Y%m%d_%H%M%S).sql
```

## üìã –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —á–µ—Ä–µ–∑ API

–¢–µ–ø–µ—Ä –¥–æ—Å—Ç—É–ø–Ω—ñ endpoints (–≤ dev —Ä–µ–∂–∏–º—ñ):
```bash
# –°—Ç–∞—Ç—É—Å –ø—Ä–æ–¥–∞–∫—à–Ω—É:
curl "http://localhost:8000/api/v1/prod-logs/status"

# –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –¥–∞–Ω–∏—Ö:
curl "http://localhost:8000/api/v1/prod-logs/compare-data"

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:
curl -X POST "http://localhost:8000/api/v1/prod-logs/trigger-prod-fix"

# Live –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:
curl "http://localhost:8000/api/v1/prod-logs/live-check"
```

## üéØ –í–∏—Å–Ω–æ–≤–æ–∫

**–ö–æ—Ä—ñ–Ω—å –ø—Ä–æ–±–ª–µ–º–∏**: Alembic –º—ñ–≥—Ä–∞—Ü—ñ—è –≤–∏–∫–æ–Ω—É–≤–∞–ª–∞ seed —Ñ–∞–π–ª –∑ DELETE –∫–æ–º–∞–Ω–¥–∞–º–∏ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É `alembic upgrade head`.

**–†—ñ—à–µ–Ω–Ω—è**: 
1. ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –º—ñ–≥—Ä–∞—Ü—ñ—ó
2. ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –±–µ–∑–ø–µ—á–Ω—ñ seed —Ñ–∞–π–ª–∏  
3. ‚úÖ –î–æ–¥–∞–Ω–æ API –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é
4. ‚úÖ –î–∞–Ω—ñ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω—ñ

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ë–∞–∑–∞ –±—ñ–ª—å—à–µ –Ω–µ —Å–∫–∏–¥–∞—î—Ç—å—Å—è, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –ø—Ä–∞—Ü—é—î!